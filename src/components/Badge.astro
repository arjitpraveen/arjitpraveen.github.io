---
import { Badge as BadgeComponent } from '@/components/ui/badge'
import { cn } from '@/lib/utils'
import { Icon } from 'astro-icon/components'

// ==================================== CHANGELOG ====================================
// Remove non-dark theme:
// bg-...-.../..., text-...-... and dark:
// Use @/components/Badge instead of @/components/ui/badge for: 
//    1. @/pages/tags/index.astro
//    2. @/pages/blog/[...id].astro
//    3. @/components/BlogCard.astro
// ===================================================================================

interface Props {
  variant?: 'default' | 'muted' | 'destructive' | 'outline'
  className?: string
  iconClassName?: string
  children?: any
  text?: string
  showIcon?: boolean
}

const {
  variant = 'outline',
  className = '',
  // iconClassName = 'size-3',
  iconClassName = "size-[1em]",
  children,
  text,
  showIcon = true,
} = Astro.props

const categoryMappings = [
  {
    keywords: ['project'],
    style: {color: 'bg-indigo-950/30 text-indigo-200 border-1 border-indigo-700', icon: 'lucide:code',},
  },
  {
    keywords: ['academic'],
    style: {color: 'bg-yellow-950/30 text-yellow-200 border-1 border-yellow-700', icon: 'lucide:graduation-cap',},
  },
  {
    keywords: ['write-up'],
    style: {color: 'bg-red-950/30 text-red-200 border-1 border-pink-700', icon: 'lucide:pencil',},
  },
  {
    keywords: ['tl;dr'],
    style: {color: 'bg-green-950/30 text-green-200 border-1 border-green-700', icon: 'lucide:book-open-text',},
  },
  {
    keywords: ['中文'],
    style: {color: 'bg-amber-950/30 text-amber-200 border-1 border-amber-700', icon: 'lucide:flower',},
  },
  {
    keywords: ['español'],
    style: {color: 'bg-teal-950/30 text-teal-200 border-1 border-teal-700', icon: 'lucide:guitar',},
  },

  // Technical
  {
    keywords: ['rust'],
    style: {color: 'text-orange-400 bg-orange-400/10', icon: 'lucide:cog',},
  },
  {
    keywords: ['python'],
    style: {color: 'text-blue-400 bg-blue-400/10', icon: 'lucide:terminal',},
  },
  {
    keywords: ['web'],
    style: {color: 'bg-cyan-950/30 text-cyan-200', icon: 'lucide:layout',},
  },

  // Projects
  {
    keywords: ['in progress'],
    style: {color: 'bg-amber-950/40 text-amber-300 border-amber-600', icon: 'lucide:loader-2',},
  },
  {
    keywords: ['completed'],
    style: {color: 'bg-emerald-950/40 text-emerald-300 border-emerald-600', icon: 'lucide:check-circle',},
  }
]

const getCategoryStyle = (content: string) => {
  const lowerContent = content.toLowerCase()

  const match = categoryMappings.find((category) =>
    category.keywords.some((keyword) => lowerContent.includes(keyword)),
  )

  return match?.style || null
}

const content = text || (typeof children === 'string' ? children : '')
const categoryStyle = getCategoryStyle(content)
---

<BadgeComponent
  variant={categoryStyle ? 'muted' : variant}
  className={cn(categoryStyle?.color, className)}
  client:load
>
  {
    showIcon && (
      <Icon
        name={categoryStyle ? categoryStyle.icon : 'lucide:hash'}
        class={iconClassName}
      />
    )
  }
  <slot>{text}</slot>
</BadgeComponent>
